{% extends "base.html" %}

{% block title %}Instructor Dashboard - EduSphere{% endblock %}

{% block content %}
<!-- Dashboard Header -->
<div class="bg-navy text-white py-5">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-8">
                <h1 class="display-5 fw-bold mb-2">
                    <i class="bi bi-person-video3"></i> Instructor Dashboard
                </h1>
                <p class="lead opacity-90 mb-0">Manage your courses and track student enrollments</p>
            </div>
            <div class="col-lg-4 text-lg-end mt-3 mt-lg-0">
                <a href="{{ url_for('create_course') }}" class="btn btn-warning btn-lg">
                    <i class="bi bi-plus-circle"></i> Create New Course
                </a>
            </div>
        </div>
    </div>
</div>

<div class="container my-5">
    <!-- Stats Overview -->
    <div class="row g-4 mb-5">
        <div class="col-lg-3 col-md-6">
            <div class="card h-100" style="background: linear-gradient(135deg, var(--accent-blue) 0%, var(--navy-dark) 100%); border: none;">
                <div class="card-body text-white p-4 text-center">
                    <i class="bi bi-journal-bookmark" style="font-size: 3rem; opacity: 0.8;"></i>
                    <h2 class="fw-bold mt-3 mb-1">{{ courses|length }}</h2>
                    <p class="mb-0 opacity-75">Total Courses</p>
                </div>
            </div>
        </div>
        
        <div class="col-lg-3 col-md-6">
            <div class="card h-100" style="background: linear-gradient(135deg, var(--accent-green) 0%, #2d7a6e 100%); border: none;">
                <div class="card-body text-white p-4 text-center">
                    <i class="bi bi-people" style="font-size: 3rem; opacity: 0.8;"></i>
                    <h2 class="fw-bold mt-3 mb-1">
                        {% set total_students = namespace(count=0) %}
                        {% for course in courses %}
                            {% set total_students.count = total_students.count + course.get_enrollment_count() %}
                        {% endfor %}
                        {{ total_students.count }}
                    </h2>
                    <p class="mb-0 opacity-75">Total Students</p>
                </div>
            </div>
        </div>
        
        <div class="col-lg-3 col-md-6">
            <div class="card h-100" style="background: linear-gradient(135deg, var(--accent-yellow) 0%, #e8a800 100%); border: none;">
                <div class="card-body p-4 text-center">
                    <i class="bi bi-star-fill text-navy" style="font-size: 3rem; opacity: 0.8;"></i>
                    <h2 class="fw-bold mt-3 mb-1 text-navy">
                        {% if courses %}
                            {% set total_rating = namespace(sum=0) %}
                            {% for course in courses %}
                                {% set total_rating.sum = total_rating.sum + course.get_average_rating() %}
                            {% endfor %}
                            {{ "%.1f"|format(total_rating.sum / courses|length) }}
                        {% else %}
                            0.0
                        {% endif %}
                    </h2>
                    <p class="mb-0 text-navy opacity-75">Avg Rating</p>
                </div>
            </div>
        </div>
        
        <div class="col-lg-3 col-md-6">
            <div class="card h-100" style="background: linear-gradient(135deg, var(--accent-orange) 0%, #c23616 100%); border: none;">
                <div class="card-body text-white p-4 text-center">
                    <i class="bi bi-cash-stack" style="font-size: 3rem; opacity: 0.8;"></i>
                    <h2 class="fw-bold mt-3 mb-1">
                        {% set total_revenue = namespace(amount=0) %}
                        {% for course in courses %}
                            {% set total_revenue.amount = total_revenue.amount + (course.price * course.get_enrollment_count()) %}
                        {% endfor %}
                        ${{ "%.0f"|format(total_revenue.amount) }}
                    </h2>
                    <p class="mb-0 opacity-75">Total Revenue</p>
                </div>
            </div>
        </div>
    </div>

    <!-- My Courses Table -->
    <div class="card shadow-sm">
        <div class="card-header bg-cream-light d-flex justify-content-between align-items-center">
            <h4 class="mb-0 text-navy fw-bold">
                <i class="bi bi-collection-play"></i> My Courses
            </h4>
        </div>
        <div class="card-body p-0">
            {% if courses %}
            <div class="table-responsive">
                <table class="table table-hover mb-0">
                    <thead>
                        <tr>
                            <th>Course Details</th>
                            <th>Category</th>
                            <th>Price</th>
                            <th>Students</th>
                            <th>Rating</th>
                            <th>Created</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for course in courses %}
                        <tr>
                            <td>
                                <strong class="text-navy">{{ course.title }}</strong><br>
                                <span class="badge badge-info mt-1">{{ course.level }}</span>
                            </td>
                            <td>
                                <span class="badge badge-primary">{{ course.category.name }}</span>
                            </td>
                            <td>
                                <strong class="text-success">{{ course.price|currency }}</strong>
                            </td>
                            <td>
                                <i class="bi bi-people-fill text-primary"></i> 
                                <strong>{{ course.get_enrollment_count() }}</strong>
                            </td>
                            <td>
                                <i class="bi bi-star-fill text-warning"></i>
                                <strong>{{ "%.1f"|format(course.get_average_rating()) }}</strong>
                            </td>
                            <td>
                                <small class="text-muted">{{ course.created_at|date }}</small>
                            </td>
                            <td>
                                <div class="btn-group btn-group-sm">
                                    <a href="{{ url_for('course_details', course_id=course.id) }}" 
                                       class="btn btn-outline-primary" 
                                       data-bs-toggle="tooltip" 
                                       title="View Course">
                                        <i class="bi bi-eye"></i>
                                    </a>
                                    <a href="{{ url_for('edit_course', course_id=course.id) }}" 
                                       class="btn btn-outline-warning"
                                       data-bs-toggle="tooltip" 
                                       title="Edit Course">
                                        <i class="bi bi-pencil"></i>
                                    </a>
                                    <button class="btn btn-outline-danger" 
                                            onclick="confirmDelete({{ course.id }}, '{{ course.title }}')"
                                            data-bs-toggle="tooltip" 
                                            title="Delete Course">
                                        <i class="bi bi-trash"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="text-center py-5">
                <i class="bi bi-inbox" style="font-size: 5rem; color: var(--text-muted);"></i>
                <h4 class="mt-4 text-navy">No Courses Created Yet</h4>
                <p class="text-muted mb-4">Start sharing your knowledge by creating your first course!</p>
                <a href="{{ url_for('create_course') }}" class="btn btn-primary btn-lg">
                    <i class="bi bi-plus-circle"></i> Create Your First Course
                </a>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content" style="border: none; border-radius: var(--border-radius);">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title fw-bold">
                    <i class="bi bi-exclamation-triangle-fill"></i> Confirm Deletion
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body p-4">
                <p class="mb-3">Are you sure you want to delete <strong id="courseTitle" class="text-navy"></strong>?</p>
                <div class="alert alert-danger mb-0">
                    <i class="bi bi-exclamation-triangle-fill"></i> 
                    <strong>Warning:</strong> This will permanently remove all student enrollments and reviews. This action cannot be undone.
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <a href="#" id="confirmDeleteBtn" class="btn btn-danger">
                    <i class="bi bi-trash"></i> Delete Course
                </a>
            </div>
        </div>
    </div>
</div>

<script>
function confirmDelete(courseId, courseTitle) {
    document.getElementById('courseTitle').textContent = courseTitle;
    document.getElementById('confirmDeleteBtn').href = 
        "{{ url_for('delete_course', course_id=0) }}".replace('0', courseId);
    new bootstrap.Modal(document.getElementById('deleteModal')).show();
}

// Initialize tooltips
var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
    return new bootstrap.Tooltip(tooltipTriggerEl)
});
</script>
{% endblock %}